 import {Scalar as S} from 'ffjavascript';
 import {ZqField} from 'ffjavascript';
 import { buildBabyjub} from 'circomlibjs';


 const SEGMENTS = 171

 const ONE = S.e("1")
 const P = S.e("21888242871839275222246405745257275088548364400416034343698204186575808495617")
 const MSB = S.shiftLeft(ONE, 255)

 /* Built with the constant 'test' => like the reference ZokRates circuit */
 const BASE_POINTS = [ ["13418723823902222986275588345615650707197303761863176429873001977640541977977", "15255921313433251341520743036334816584226787412845488772781699434149539664639"],
                       ["10096735692467598736728394557736034054031417419721869067082824451240861468728", "16704592219657141368520262522286248296157931669321735564513068002743507745908"],
                       ["13312232735691933658355691628172862856002099081831058080743469900077389848112", "13997829888819279202328839701908695991998552542771378089573544166678617234314"],
                       ["3514614172108804338031132171140068954832144631243755202685348634084887116595", "15464894923367337880246198022819299804461472054752016232660084768002214822896"],
                       ["15118628380960917951049569119912548662747322287644759811263888312919249703276", "20910093482714196883913434341954530700836700132902516503233669201436063149009"],
                       ["12047448614322625640496087488290723061283996543855169192549742347740217312911", "16179347143471683729835238045770641754106645772730542840306059882771262928390"],
                       ["12701245173613054114260668542643518710151543759808175831262148773821226772548", "6893882093554801220855651573375911275440312424798351852776449414399981870319"],
                       ["2944698428855471170284815781705687753367479016293091716206788980482046638948", "17360101552805013843890050881314712134389035043192466182420273655548320239406"],
                       ["14561966822440683665541629338358038450751192033904756806839710397580365916408", "2103279357051120614300268561700949519576521616178686690761693996681299230890"],
                       ["6226499033652114521979121779728984801913588832404495199289210905837818402723", "7443974969385276473096219793909172323973358085935860096061435962537700448286"],
                       ["7079401365241105225661961622760419818013463250349580158302569256283647306129", "11050535702333135359874644130653446287886435768224627066379760227644857448025"],
                       ["20192636532359225751119979205906307972955330178954709766736232115035084682472", "17748517956264309916268005941322895780280007418421226047127160997826331847601"],
                       ["1324920405111324350836746707883938204858273081019435873511569172015916187999", "16984705452766649815073644511059333480190120433850502120324063182300137456908"],
                       ["10184781845128697471817965179509651550812478664395958690225791623061609959495", "12481681651435870984379558646813686612408709833154117210578901875084149402369"],
                       ["10680962982327504072121608021689834159178144997131600234373184928312768469752", "4698845013673361363032641974440465619959991809676353365742268606915462346702"],
                       ["559099661340368706731458173062937049444139592208939239637572972395409815235", "10744092763718531253355077100374662669098109929848484460119044326894952631009"],
                       ["1678013963086824122518234712588270403106471527976328603364788331772512526348", "2187428842929094383038114367392650175780437811274194322303902357941058607339"],
                       ["12873968423948310899392467568104977730716801401622261861937368089215309803500", "8139007031385157566567411468459940290231498857090568363629902873306461631248"],
                       ["7778254495039611795685039895928787457435875136389165268120013630439201169232", "7284679595773642123118330714484999203099307921555787993734753019057231440983"],
                       ["3630756302007400417952089805331380555952289748859891438940570770932527475452", "16596280733402230599955345374089507399680037832193751466748596443674569931646"],
                       ["13428507160783248146944378848829437095621758280249270905793449036777555016842", "16698341695430068847582701171147088836738454320587148532489385958997389524692"],
                       ["9001788585918405588944162583417858847457169702891113291878897002187678929577", "2208441895306047741608356002988212098270630744976300198681224594148576837458"],
                       ["9370960127159127445266474449258070389736162441470427007490084241211557822341", "10405035931558887078762806053185283924863039263200495982754625705264574757491"],
                       ["9435538689621391149659891449161022313817917158768482063316123517911261629051", "3766822724536031967241092846229703633913210151222385593884505545907921188272"],
                       ["5859172856191457066677368896012140820864205253768332100482413148381377691822", "4836009713585714465496581912154882382453931120914721557804515434755336832208"],
                       ["4623242138639627730014370601705308411725596532862597538813607327046410321312", "6538526769564699401600543915225940144078494544354769810309083421131300518775"],
                       ["7426207409769264985012540642921370782277366662985635838803842004294008785185", "16458635168452867431186476181702908205218256620571557119181621733008943007186"],
                       ["9274793422641213328277630692090429447322754602554792362167389139799628719939", "2125001664000799929029867649528637137680130729147235858348667725168119291610"],
                       ["13710259114758767844337497139752382122951774216678047790125818858626546865590", "11846136982947366289908137269088548542970460276305965388699657623060915691485"],
                       ["16898533007964698268976570330413504736326631860509774315700399063143612293661", "19301014021919583977567348438857464752913991729661145830439339193394619822674"],
                       ["184222443282411811008485293978090987184574946550463281113036487016967683795", "13850322095814274715426304026104710047724256505475254494587134658322670671529"],
                       ["8995760760295995916308082490351740974639094331313720900267671545759667549796", "19514976680591593876219573359164805119998241765130948583982557052811782267484"],
                       ["2527638437523893015660301196665088766965588386392795314680197258969354623363", "19210721144465266426749734142673856566947869352583355496554030705736452071361"],
                       ["15846792621646742652974245065938230651829248095884295067743275618391603947137", "13124560942345768357314581178595700674622208923899518932907915338485045148127"],
                       ["9161164860624082016500689976633279187120278305601384250238486553068325633742", "13685063021736046635507535227140671955502404587270095297507854657927533098685"],
                       ["13763732875937305178862849318112327966371606623409616602363024527079535241003", "15902927258231569893737955890837667742457214947649307818302524420399149241212"],
                       ["3511208839914156996602850728297722115315702089624058744395068873552707949103", "9113093883676083424918242033136578270322417571556449454840754893578163802387"],
                       ["11522295231047132260758343744179190547608150890072723735296048871441325064339", "10997633658189180813501132314065688584832302881630691645920837501861598079973"],
                       ["13408931465122001423751414891302829165042502658140645208130973182525808774770", "9267742985382681478817853200119409918969418222977519894367804134923874406267"],
                       ["6540890698262697218677202035403667770177820101154223149908034301445959517274", "2642034845320222085946302229307945658183260378358994660373441270519802248925"],
                       ["3375661072576892623715175468380800047905893262660913295358697027074087217513", "8987539541637688797931012030256009083390767313291834963652110291129797020941"],
                       ["9662184175454991631880218147488300829920024817382740712599708905755708816803", "16632142917625566129622048663670437511136716491293457317746859226945397089536"],
                       ["20252038718269174556829574777069549258100538764143309785207012647062643184902", "1949203652074521007058676904301415827566224382778317340432698169556879788463"],
                       ["13929197264592281054662634434397205757522163835293158725199610804948038924930", "20928589942441069163400310179733448745002695258624629275677130484867901611592"],
                       ["20820962511183569148336349677594457306122370638840390080208640481304634109972", "18802948623154501291575097526503171935564067914914679326677986205652424463305"],
                       ["14908874845345243542374913242177817956756346686642792660468745914078612972964", "5109688569541183345813508363367270401129385455666732942384933494548859595681"],
                       ["1154476465911192808082307928347900064111325728833428891094393674593800812900", "6461899930945412323497751736369894620103555271239754245787726192367462376648"],
                       ["3106120971963814637086817095821216892657807437909030172048489357608690908664", "11655780578227604806047758025034240629153798954712964172707380870816316797993"],
                       ["20374356410965803131887119977813187747682102078262988894186807366145009893312", "15298182760377768633156209223343487909782393543670382286190369588693664098885"],
                       ["14165004713755765453589527153323887724160944086658242248604905215519807263185", "20401715072789557220769413113920881979690352159560582443280493351937640089943"],
                       ["8103748105126096403620617531109165346111017883414253359146860083465308290054", "6900602880532330473224374524196761198151861405485326291615150754345009304151"],
                       ["382543238316875203894587902417533689378617036331411163099475938996384971274", "4793004393185972052681267640894832507973895495734257655931836941627180322533"],
                       ["7242980429824960501440666232145028986161691674990466362832703971174936796830", "2313823382391584526084833833122921512331314230217820828722208559851046887792"],
                       ["14129501557712467097681133312480956681237794589418881140932742431414452181802", "8967890713970048745032869372462848543847652746940083058618452105243173038725"],
                       ["5456157947126010471455582105823966618048439614862840203794276433144936442303", "9440520397717291873292501513394144011971438675685104804031688857727475979708"],
                       ["14850732473677774396477975866215714018387310838284937771253941847508860390570", "11812452402407343928752680921354215607515699690942611270817873638995622443255"],
                       ["13157890071808158704354468737847471048810392369152727364639634059504126884874", "893279927671356626449601197530638356692800493991878277093322197544680454846"],
                       ["20379496501734200220097501155104742700678033944324898621914782326376426827694", "6312536910770269621417292581781438152243262819530627194840110225345012746549"],
                       ["14193197030749382932133736734505537242924559995077781886176225169837220402133", "10015961841973388881391587018151977950817576225746650865142918877894543270446"],
                       ["21185904177969045625821216347084191287459806531017721293624058180265336503811", "21681922300753515822840018285496181872470481450737464910861242457369823926925"],
                       ["14071560871369419892033259843192185467358801846474749773427241883409830032328", "8710777380190521326883551341251426052007249230093350101154473409247609882825"],
                       ["20777314589605673759170070653370407645867665889025835324139659856710113131826", "2644721599238941245572401477946144870669550581359063534170381908963477379532"],
                       ["11749872627669176692285695179399857264465143297451429569602068921530882657945", "2495745987765795949478491016197984302943511277003077751830848242972604164102"],
                       ["5139361255050232661773452561726452928115803730344567411456642256556217045338", "14036051510959474100046039284978060652197630794277473374328558492372137493500"],
                       ["7037199118537155369331275916815326054696699996573020862644806346516390510132", "13107688056462500445700480209995877016295689081542565992250464593152667593220"],
                       ["5946112335249256697077095359378565725733629742750694340878812663903909175901", "7559787099338642680034184654424868894988928943730034769673486129058256478240"],
                       ["41373522534463253583709483090344938032869463670116114182911184041610044395", "1812970364913777725848745565574644898635129603904027984751613694625700239455"],
                       ["19366353265983664793480214800587120487923062015491759603977854723148315579274", "10425762558101863677692090103799691698591185440858290129753641015260969124568"],
                       ["15647575844595805283124278572298605369081553302159286302039104118434564547757", "18121989769429113110431033241130632527148185431169035091659247063715924437727"],
                       ["15099126396506559307312697471585164108461593918632286769972271267945539855806", "11185464183896587792324099270269738719144599552792757002841466742562118002961"],
                       ["5586425841805464495367763159434170408121119147683098906675715851224959199555", "18977748529759410811480134751116373952642146764796083016667926272252310801539"],
                       ["8067396068830332270789178613335432253659758303711969642714931687060160381303", "1109389204114118726338211511183391561882818362713716952828416479757048480713"],
                       ["14694205333290671963708923368506587408024223912051732033761240288927263651380", "9656049051507081163863869851380474393220762381365090138663873299937439711626"],
                       ["12368397247649882906953915991250714931614715588424094368585746160811998953306", "813793955589589118694666569995091571992486583635127942664119751723536369919"],
                       ["7187732531650016705045248947412886871494880941757180032721434029527647591174", "7505964932526905326140236282846132917485872002527800757209057356562826370965"],
                       ["11880592453253678945312808709337779570677968939895786745513483795196121148239", "19319714983097503154896952315362236888483358620825042533226116711980128027594"],
                       ["4665897628623235203637312232323957679483103295583092141578808282040205079719", "20713846021060085908071105513304556412817630308151607438714049866357354550752"],
                       ["18212889377782903846034117170355855193339291343619773736161614903123505780500", "14150007145691261709583376556777715716099818143565185837820917588114159379297"],
                       ["20014362392122060372382978901186124374461219393111624832280409989286374019151", "3781524301363795687584984812832316590367643113392401377547409393858835211208"],
                       ["9734499467834650890192498500298459962067559704398257089549121433441674087115", "4354361275489184569727883669567924050940590772506719250562939951242102459556"],
                       ["9547054830379311239093093214427099367592481292385809745992166194109928893132", "13627319622459471863286677434492810110443625239619395014230589374758547978269"],
                       ["5462734684060346793723051717116621327144354637585189012464556861789633254735", "19956048369873968081515874523485925798105246605761695905870795560621002747577"],
                       ["14120934246971429747829618071104732571014495017644755746350410437296386191831", "20946993100078048703890437478651577253995893117657499778417778292965813281806"],
                       ["10074124480658003038181060843544012751655263682971006047574974839001332519369", "6742523042997173838799423244280133352249230789995302906545025471831316165384"],
                       ["9734317150772506967195863825775613184177780587009303743393397724706924797808", "21086552119896541186107689532205383551960199801453516689016972250104900583432"],
                       ["19897146034704593618377175099239959996606643851373776355482440566659528393713", "12223657826278264815494051932052421695129917274617530304443478482578919678308"],
                       ["8185677100333640041421355126903921619342273914070568426300075868606141405021", "5730721122742653576294802609542803235749403433458024692842251665338778112357"],
                       ["13654034957145907815962106285631017905892861670471883127206658577251723739165", "14648234277430895067547661111448501238234630914838612427562971477472564218927"],
                       ["10625366736090949097208784405733508126867531010210504034282606844498242195460", "14732913015624058203205922728424826465278063568996784510238321594483738024116"],
                       ["8424620995080153959855099087384460880708718787657472234234125992142104413784", "8774350273413061850499929377371854983526435316805379820854063460345613579740"],
                       ["8559837035180670877234803295116293964077309001575836599087921933374799946149", "839500690449928047855071514156387100713350925422279056462945330783580827563"],
                       ["2094128027031828157560092686172909842260483168819281235210539106189673022187", "11349460624897126395359735030876451695289908168621129531254166231469594999395"],
                       ["4354759259287077683606602421630609654573093874872166313972356669642414450557", "215179997319049227050677351252505122489806707992988193421803248841509506088"],
                       ["8507753630181199902479216321724505843375506218865451254864654248120523505482", "10815868200773974736475276546832667321164179489094422703987813447328543028788"],
                       ["13109291774440010508838814834344208104350382843329321595606001193219335478061", "12538966751785809241486764416198217361134417700423840996157483469862141526006"],
                       ["10225920463059329189289679689043403756461771898061631555012236633674500607894", "14845268720181506270843668435047795143673881800644972711347963164805203292028"],
                       ["4836760236524137019788853323648085337078365119204570171912328851849081302469", "15727462261854339392836033936665994570356817309630572739663218192786419709049"],
                       ["20126221763126240993614454578144859888701958472483256034667342833856637405284", "20063374408209966489810045113711694748195105838875731221209079272072900704065"],
                       ["335301756618437339439144029360964383534478515390448989496515998200065120560", "5048381480643837407413881593434054866090196361251156389103862466064034755870"],
                       ["4778598962832696072676642978625204359871247189399816084941520023705687820799", "6056883361340614567315212379835078890341975776819628834401238537031161511515"],
                       ["6916961985409927380628327393774423923434707859806165446564471158322143896430", "19113997592137471372275504986229466743101683336744251847362311356790431849943"],
                       ["10948634109523663410073892096301229908363974454242026292710198013874268733721", "13978844239437491612582517692269818179489578402023377256168376965218369369939"],
                       ["18995578047969205917336954191535061050094635635378379108624715348396977983189", "13847262887662907650775044616657488013627923118617883909535158774246706595453"],
                       ["15920090333582846150341817050024564335649064112537068561935372152494077145209", "17200096279975283058225939790642290750952306062383335630123644381672038262866"],
                       ["17405833224461846119127359023602459766899246377474167154738658246656617261320", "2379006936139604897517171125029127132096844925377650383092744055973319489305"],
                       ["12917351824629483440622737030529674983967542988637720886395195031194160632079", "16674117998706559220643814233136742237729068875288271911312504301619597199572"],
                       ["11485514708661668839797104792911993330100465395538998907154500209956717209980", "9353349283824572334689034791316525426505799181965760097150790472211583538470"],
                       ["12732753810746517185428320079630798046136898905138090354428070504022561261129", "18703753174721947326863540292822225800192529767109903887849391280378615950879"],
                       ["4396441250850868966014141809834014631796411613521413364533261157108807304791", "2981405188098805378415778407831807030725264692497108694734382487084076855210"],
                       ["18448980711993048271679830178954781281796619509660919482566515137849326949705", "13538295481673593444396948705042001770075594914797407330259513771278632533788"],
                       ["8789386218557174287787274081526754120821582438440596481230009033085305168336", "14711352054903619189890311113670897561016852508413508359380114647296690234759"],
                       ["16410879947793378178852309134034691965068173351773904636443113803287073468165", "13525280335627612179489028500357999227382280656020782481971742893960563718069"],
                       ["6360670162449266467030644276184864100593477111108480032796373772347480922189", "14257529111287275777165336596087530152135443364949890695933859730727871380736"],
                       ["10885915218940734071225780147170174316285574070557833147925199753671864395970", "11029057981581926429073650712620964484769971154264787930046960173769123662678"],
                       ["9591625063099557813317657356201310094684652614430671855551305338577894715651", "13661097518448111362501604180288489621905168345464166181035334250815558586292"],
                       ["18886312892727437565309004732784060353326028914324367568840970250261109059822", "20097067895510901824034782908594630518461908899922907976633298936904395310483"],
                       ["9611980085915454916721710377398516249069657290776790665729578385653465657608", "12531050708955702438977554896456788618229483698488185884652134859969233228127"],
                       ["1741783015222897367309800534949631760951606605798891132137371646304340462458", "163811524362553669200342941603136686901966525127089114473510248213711571683"],
                       ["19845239752872171546325855177077796460784181475810291663797620022786920823647", "10413380090476979012716640518612591288231919255093118763710930970879877622297"],
                       ["21840644145325684882015312401601386817913954005861480185552664536266852358123", "8473655227220833354585864220301666825011510607427101884196854510787991763100"],
                       ["408538855946993109150255210001390137328762855947155164309686603040268044308", "1479997830732538227417547327573357263920837878818360220214252494202287418999"],
                       ["16909060815089078676939420644976457427406147473547024017569298235433420995548", "9691045028169014905240668289132134803037917344396639164551352440947925851528"],
                       ["20571623498624005071141088211057092924213194074152586837454876463843418144025", "16001479421972757821409642160488722706981473283972847385882762682377724905156"],
                       ["9888014007610840933022906589732806947017424423907994528302713554488676542739", "15251452715683470293001422999667336542311051361914428663773647008481320118023"],
                       ["11201877561392804928547433284377926158320532448010089457664943460838007583898", "17554707027223374526818340909253875671094356182527312776837442099008513816809"],
                       ["8041169655049264647027531522783115313651111026520000925526843693578880103225", "16996116430274827689271070440218340032465717731948638724397047789367189212654"],
                       ["19334565048001467439446889504730002771044189757270166846813098304840682799995", "11177666514768283886285136134046021748603781779508224469021361511080086667157"],
                       ["10764100134342681938975151936530775454161936697333679961141539476099641645903", "19850691100864531393976360616243718992492409320965998539447518686463634627384"],
                       ["7984775939876417845202037337929702281039643807160799398396389954446436630245", "11644088529951120466123058306783377782553679447618569394424538939634266570688"],
                       ["5565157198993964726485879908963280627890845525340341493437203971709365228330", "16047978233091600592523116252839158499254716982332498268149527514947495047441"],
                       ["724617195994552100441707186007100945318061137735042194166321801565168264994", "1941243639179655563586549731833523575056282199989602716546318426577162114198"],
                       ["20917363825188238552045899784153496987535745925685770873105753565860443082365", "1745736425002501661522536470728945366618822522645696668197436988525466413140"],
                       ["12673489410414637838905637938820402546181123854591818062100393889121109718668", "2273218791680662828916671149332560291571458847138066661294611637128783792792"],
                       ["1596291013949010721288060595532569432608538778619836480784785471074053165112", "7862378404177401992071889396713852447802454946236648304807328682371781930090"],
                       ["13383782376835328120051264492485947246229335501182593669024066132006083860995", "1452388014885069534714863742557414467294079407912495717272255602231974271039"],
                       ["13165533527694513928104129943149460933916076941607396715443729707678633985673", "17238425515895072477563840544058923640858290538130746390995636765338905591675"],
                       ["7326992374695153334569399469397596928696501586886381702972942656080738560504", "3441991977044037545935620478935168226411039028254665140927991316702138513190"],
                       ["4380971751033847027929691061398944531722909263311553031455521197665070771642", "16794605741797752486161164743285493892529567663448780177764044251817860406839"],
                       ["4325450975911066881724043517797022496124195434220888316197251865366294339361", "18556589125306655880844231674670238467511897504977535323905816448582480367724"],
                       ["3049906494165633773067493912990013841965806179225048735919293547905816967010", "1139270967545262231620743596254789040950691396231510347534297369410226811042"],
                       ["19942746034266536069392101170115851306620344112551007974939114086497358930858", "5234335526367392822375043936890479400588416815383747301372644960641216357795"],
                       ["4345203866646269633300579468877411954334981515932585752657225898484243906660", "19711785928362785984568609948298550809737208754846854010480265206080190724688"],
                       ["13604959715661441436052939762464429298226713418171390314110026091418525209941", "9106634253925907822997376723908848470389744101982447244238790923479221740587"],
                       ["12272981972646946567553896730199881959247853499104488943992635249117595393209", "12840198036955871442566173317906222816787870441489199428401326600711994709214"],
                       ["3005593847772820450050205074163314509976806377772621088836578637506564062913", "17258587025904856892544250820556722922327972240440200527118380921147955645556"],
                       ["21553262056684585969628674122764109775958361035991194009613252605155913211334", "14469270633466381305852216281125837079646617198515099740000541993840798471084"],
                       ["11763347508086007810977359866267798246514404258245360557926263268200652076963", "14706162498378202954074913829047629685039231677186626739445882650545999503202"],
                       ["4356994949172878276640972387865792898708144237321291982532719592191935134502", "14574692378125259586817945291111936727424704391123959334117252195469092200764"],
                       ["21880820504467716634106664909402072165472960350877194774465177915127008092893", "5182168744456816656485869911241149693404052223082761825064601932558781730740"],
                       ["8936781701927368370215210870827508937678765478808217533286287559934624784681", "4623029543859886044767307470074323247069187031547412019261660683452990785239"],
                       ["7946459614521142644206204774850419894186577869297360917934350740375926112382", "20393528966549387266343193152712146799161036298032725317477228673291507957942"],
                       ["16996326686259093178712301719114535464147004200933701699216923172711169217776", "10879703765081907416589976314120373073533854885503210038919805342729980088501"],
                       ["5948355082391370971277814822201259570199411254972015395356071689733858457870", "18781938632634665629392534748457372928296731257744451684662925940692495070899"],
                       ["4801783634053958699406131208260321653724147389806778300442394152288266622390", "10503832530625380631086165586158401732075983866290617431349835924922749109699"],
                       ["5093610893249308867168031458336741939196884648123926997975341654608609426830", "10952612598118313917631759693602817846928839860096429550603703046117049639522"],
                       ["3794104339739491010449122661216407115137782001618163380131794160705537757426", "12842968623255283384772731210441087433561383555541999360200972373794310794093"],
                       ["3459245219635302288341483992140272707638915493010622274381776793623419230591", "17415928452277952995861857592997544802223350915817518744596816398543561612106"],
                       ["634964597278986129282215293208138156361395902716873910540311662219517773576", "17203635141310737823252743409317633065422478971915442288649227045499339781109"],
                       ["20098437969178934435495041700635313630962028038875583770224318127835756299529", "877613904095171787446316454384924363436490179245069691113043218080238972652"],
                       ["17889638686175315317941901427709143202478522471798280927986774735210637820526", "17728898667133884634264046347611298588924985692465583707491826367590591819161"],
                       ["17159516188699622404527134263356371503443962451842558111890221401200764258125", "288697205606498046198642124865852628925547477970007319079115715396675917499"],
                       ["11476903323853344813827041345787850966667514952865946400953029235796901464022", "21544495907681885621399294493301860022991247894450553860102494438499516461036"],
                       ["6740469135284996394159167279126920754449900660887428959259136317440159292867", "12559437556228574824459283742977065667884462966124147526010574650373707978536"],
                       ["11683193590608313373089435698057644614965227085254736967478627707109364481009", "14089407095672561058133609212857713657125336981293206062798215054918146117895"],
                       ["12391241461796318677666973225906912103063953603374991439355987755433936571792", "6256323253756510425990684148198273229283967340029341825763386143854418092931"],
                       ["12090834415198821488072985841187199896460619427268475889346428879276625683876", "11186634643432676423242372187246648742599522445001126220151236883458565017089"],
                       ["9073477014345643942359994649331122800736234440180113066690071117218958686221", "15421230006761899572959376594938017439120427450367920423701622807634638005218"],
                       ["17605212659450062681090282709904508607567301109002577655966314961623397498778", "18088283300102077232647028354145534410326244238430555546504288886091850910025"],
                       ["3898901470837850662399020072718316987511815396623761376502150466549773974269", "18552945270636575492780160887690665046683842994616480518496617903497833044944"],
                       ["6124403322044682705571649214069113177521499060664580284884665715951975035077", "18191174947339798787646910619446409943766046946921136035021645191602921923040"],
                       ["3342564788366736273905106071612128667477972061160313630133110787799686301495", "2329094643034533408459502544740928833981119919633412709248656884170940780093"]
];

class Pedersen512bits
{
  async init()
  {
    if(this.curve)
      return
    this.curve = await buildBabyjub()
    const C = this.curve
    const F = C.F;
    this.base = BASE_POINTS.map((x)=> [F.e(x[0]), F.e(x[1])]);
    return true;
  }

  hash(value)
  {
    const C = this.curve
    const F = C.F;
    const _bits = S.toArray(value,2)
    const bits = Array(512 - _bits.length).fill(0).concat(_bits)
    bits.push(0)

    const apply_sign = (x, sign) => sign?[F.neg(x[0]), x[1]]:x;

    let idx=0;
    let acc=[F.zero, F.one]
    for (let i=0;i<SEGMENTS;i++)
    {
      const mult = bits[idx++] + (bits[idx++]<<1)  + 1;
      const sign = bits[idx++];
      const base = this.base[i]
      acc = C.addPoint(acc, apply_sign(C.mulPointEscalar(base,mult), sign));
    }

    const x = F.toObject(acc[0]);
    const y = F.toObject(acc[1]);

    /* Returns the Zcash packing => Set the LSB of y to 1 if x is even */
    return S.isOdd(x) ? S.mod(S.bor(y, MSB),P) : y;
  }

  hash_nullifier(value)
  {
    return this.hash(S.shiftLeft(value,256))
  }

  hash_commitment(secret, nullifier)
  {
    return this.hash(S.bor(S.shiftLeft(secret, 256), nullifier))
  }
}


export {Pedersen512bits}
